<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extension Tabs Test</title>
    <link rel="stylesheet" href="sidebar.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-text {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #ddd;
        }
        .test-text p {
            margin: 10px 0;
            line-height: 1.6;
        }
        .instructions {
            background-color: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #2196F3;
        }
        .debug-panel {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-top: 20px;
            border: 1px solid #ddd;
        }
        .debug-panel button {
            display: block;
            width: 100%;
            margin: 5px 0;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            cursor: pointer;
        }
        .debug-panel button:hover {
            background: #f0f0f0;
        }

        /* 标签页基本样式 */
        .tabs {
            display: flex;
            border-bottom: 1px solid #e1e4e8;
            background-color: white;
            margin: 0;
        }

        .tab {
            flex: 1;
            padding: 12px 8px;
            text-align: center;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
            font-size: 13px;
            font-weight: 500;
            color: #606770;
            background: none;
            border: none;
        }

        .tab.active {
            border-bottom-color: #4285f4;
            color: #4285f4;
        }

        .tab:hover:not(.active) {
            background-color: #f8f9fa;
            color: #4285f4;
        }

        /* 标签页内容样式 */
        .tab-content {
            display: none;
            padding: 20px;
            background: white;
            border: 1px solid #e1e4e8;
            border-top: none;
        }

        .tab-content.active {
            display: block;
        }

        /* 侧边栏基本样式 */
        .english-explainer-sidebar {
            width: 320px;
            margin: 20px auto;
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden;
        }

        .sidebar-content {
            padding: 16px;
        }

        /* 内容样式 */
        .section {
            margin-bottom: 20px;
        }

        .section h4 {
            margin: 0 0 10px;
            color: #4285f4;
            font-size: 16px;
        }

        .definition-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 15px;
        }

        .bullet-list {
            list-style: none;
            padding-left: 0;
        }

        .bullet-list li {
            position: relative;
            padding-left: 20px;
            margin-bottom: 8px;
        }

        .bullet-list li:before {
            content: "•";
            color: #4285f4;
            position: absolute;
            left: 0;
        }

        .vocab-item {
            border: 1px solid #e1e4e8;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 10px;
        }

        .alt-card {
            border: 1px solid #e1e4e8;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="instructions">
        <h3>扩展标签页功能测试</h3>
        <p><strong>测试步骤：</strong></p>
        <ol>
            <li>选中下面的文本</li>
            <li>点击"模拟解释"按钮</li>
            <li>等待侧边栏出现</li>
            <li>尝试点击三个标签页，观察内容是否正确切换</li>
            <li>查看浏览器控制台的日志信息</li>
        </ol>
    </div>

    <div class="test-text">
        <h3>测试文本</h3>
        <p>Our tutoring rates. We have 100% free tutoring sessions! Schedule a tutoring session.</p>
        <p>请选中这段文本进行测试。</p>
    </div>

    <div class="debug-panel">
        <h4>调试面板</h4>
        <button onclick="simulateExplain()">模拟解释</button>
        <button onclick="testTabSwitch('meaning')">切换到 Meaning</button>
        <button onclick="testTabSwitch('vocabulary')">切换到 Vocabulary</button>
        <button onclick="testTabSwitch('alternatives')">切换到 Alternatives</button>
        <button onclick="debugTabStructure()">调试标签结构</button>
    </div>

    <!-- 模拟的侧边栏容器 -->
    <div id="sidebar-container" style="max-width: 800px; margin: 20px auto;"></div>

    <script src="content.js"></script>
    <script>
        // 模拟解释功能
        function simulateExplain() {
            console.log('🧪 开始模拟解释功能');
            
            const text = "Our tutoring rates. We have 100% free tutoring sessions! Schedule a tutoring session.";
            
            // 模拟调用 processJsonResponse 函数，就像实际扩展中那样
            const mockApiResponse = {
                "meaning": {
                    "definition": "This text is advertising tutoring services with an emphasis on free sessions and scheduling.",
                    "usageContext": [
                        "Educational service advertising",
                        "Marketing materials for tutoring companies",
                        "Student recruitment communications"
                    ],
                    "grammarStructure": [
                        "Simple declarative statements",
                        "Imperative sentence for call-to-action",
                        "Use of percentages for emphasis"
                    ],
                    "usageNotes": [
                        "The phrase '100% free' is used for marketing impact",
                        "Multiple short sentences create urgency",
                        "Direct language appeals to cost-conscious students"
                    ]
                },
                "vocabulary": [
                    {
                        "word": "tutoring",
                        "type": "noun",
                        "definition": "Private instruction given to a student",
                        "usage": "She offers math tutoring to high school students",
                        "synonyms": "coaching, teaching, instruction"
                    },
                    {
                        "word": "rates",
                        "type": "noun",
                        "definition": "The prices charged for a service",
                        "usage": "Our hourly rates are very competitive",
                        "synonyms": "prices, fees, charges"
                    },
                    {
                        "word": "sessions",
                        "type": "noun",
                        "definition": "Periods of time devoted to a particular activity",
                        "usage": "Each tutoring session lasts one hour",
                        "synonyms": "meetings, appointments, classes"
                    }
                ],
                "alternatives": [
                    {
                        "phrase": "Our lesson pricing",
                        "description": "More professional way to refer to costs",
                        "formality": "Formal",
                        "example": "Our lesson pricing is transparent and competitive"
                    },
                    {
                        "phrase": "Complimentary tutoring available",
                        "description": "Emphasizes value rather than cost",
                        "formality": "Professional",
                        "example": "We offer complimentary tutoring to qualifying students"
                    },
                    {
                        "phrase": "Book your learning session",
                        "description": "More educational focus than commercial",
                        "formality": "Neutral",
                        "example": "Book your personalized learning session today"
                    }
                ]
            };

            // 使用 processJsonResponse 函数处理模拟数据，就像真实API响应一样
            const explanation = processJsonResponse(mockApiResponse);

            // 创建侧边栏（如果不存在）
            if (!window.sidebar) {
                createSidebar();
            }

            // 更新侧边栏内容
            updateSidebarContent(text, explanation);
        }

        // 手动测试标签切换
        function testTabSwitch(tabId) {
            console.log(`🧪 手动测试切换到: ${tabId}`);
            
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            console.log(`找到 ${tabs.length} 个标签, ${tabContents.length} 个内容区域`);
            
            // 移除所有活动状态
            tabs.forEach(t => t.classList.remove('active'));
            tabContents.forEach(c => c.classList.remove('active'));
            
            // 激活指定标签
            const targetTab = document.querySelector(`[data-tab="${tabId}"]`);
            const targetContent = document.getElementById(`${tabId}-tab`);
            
            if (targetTab && targetContent) {
                targetTab.classList.add('active');
                targetContent.classList.add('active');
                console.log(`✅ 手动切换成功: ${tabId}`);
            } else {
                console.log(`❌ 手动切换失败:`, {
                    targetTab: !!targetTab,
                    targetContent: !!targetContent,
                    expectedContentId: `${tabId}-tab`
                });
            }
        }

        // 调试标签结构
        function debugTabStructure() {
            console.log('🔍 调试标签结构:');
            
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            console.log('标签页按钮:');
            tabs.forEach((tab, i) => {
                console.log(`  ${i}: data-tab="${tab.getAttribute('data-tab')}" active=${tab.classList.contains('active')} listener=${tab.hasAttribute('data-tab-listener')}`);
            });
            
            console.log('标签页内容:');
            tabContents.forEach((content, i) => {
                console.log(`  ${i}: id="${content.id}" active=${content.classList.contains('active')}`);
            });
        }

        // 页面加载后的初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 测试页面加载完成');
            
            // 等待一下再执行模拟，确保所有脚本都加载完成
            setTimeout(() => {
                console.log('🧪 自动执行模拟解释以进行测试');
                simulateExplain();
            }, 500);
        });
    </script>
</body>
</html> 